# ✨ Новые функции админ-панели

## 🎯 Что добавлено

### 1. ✅ Управление категориями

Теперь админ может **создавать, редактировать и удалять категории** прямо из админки!

**Где найти:**
- Админка → Боковое меню → **"Категории"**
- Или прямая ссылка: http://localhost:3001/dashboard/categories

**Что можно делать:**
- ✅ Просмотр всех категорий
- ✅ Создание новой категории
- ✅ Редактирование категории
- ✅ Удаление категории
- ✅ Автоматическая генерация slug из названия

**Как создать категорию:**
1. Админка → Категории
2. Кнопка "Добавить категорию"
3. Введите название (например: "Би-LED линзы")
4. Slug создастся автоматически (bi-led-linzy)
5. Опционально: добавьте описание
6. Сохраните

### 2. ✅ Загрузка изображений с компьютера

Теперь можно **перетаскивать изображения** или **выбирать их из проводника**!

**Где работает:**
- Админка → Товары → Добавить товар
- Секция "Изображения товара"

**3 способа добавить изображение:**

#### Способ 1: Drag & Drop (перетащить)
1. Откройте форму добавления товара
2. Перетащите файл с рабочего стола в зону загрузки
3. Готово! Изображение добавлено

#### Способ 2: Выбор файла
1. Нажмите кнопку "Выбрать файлы"
2. Откроется проводник Windows
3. Выберите изображение (PNG, JPG, GIF)
4. Готово!

#### Способ 3: URL (как раньше)
1. Вставьте ссылку на изображение
2. Например: https://example.com/image.jpg
3. Подойдет для изображений из интернета

**Особенности:**
- ✅ Множественная загрузка (можно добавить несколько фото)
- ✅ Превью изображений
- ✅ Удаление отдельных фото
- ✅ Поддержка PNG, JPG, GIF
- ✅ Изображения сохраняются как Base64

### 3. ✅ Динамический выбор категорий

Категории теперь загружаются из API автоматически!

**Что изменилось:**
- **Было:** Захардкоженный список из 4 категорий
- **Стало:** Динамическая загрузка из базы данных

**Преимущества:**
- ✅ Список категорий обновляется автоматически
- ✅ Ссылка на страницу создания категории прямо в форме
- ✅ Если категорий нет - подсказка с кнопкой
- ✅ Индикатор загрузки

---

## 📸 Скриншоты и демонстрация

### Страница категорий

```
┌─────────────────────────────────────────────────────┐
│  Категории                    [+ Добавить категорию] │
├─────────────────────────────────────────────────────┤
│                                                       │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────┐│
│  │ Би-LED линзы │  │ LED лампы    │  │ LED ленты  ││
│  │ bi-led-linzy │  │ led-lamps    │  │ led-lenty  ││
│  │              │  │              │  │            ││
│  │ [Изменить]   │  │ [Изменить]   │  │ [Изменить] ││
│  │ [Удалить]    │  │ [Удалить]    │  │ [Удалить]  ││
│  └──────────────┘  └──────────────┘  └────────────┘│
│                                                       │
└─────────────────────────────────────────────────────┘
```

### Загрузка изображений

```
┌─────────────────────────────────────────┐
│  Изображения товара                     │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────────┐ │
│  │         [📤 Upload icon]           │ │
│  │  Перетащите изображения сюда      │ │
│  │  или нажмите для выбора файлов    │ │
│  │                                    │ │
│  │      [Выбрать файлы]              │ │
│  │  PNG, JPG, GIF до 5MB             │ │
│  └────────────────────────────────────┘ │
│                                          │
│  Загружено (2)                          │
│  ┌──────────┐  ┌──────────┐            │
│  │ [img 1]  │  │ [img 2]  │            │
│  │    [×]   │  │    [×]   │            │
│  └──────────┘  └──────────┘            │
│                                          │
│           --- или ---                   │
│                                          │
│  URL изображения                        │
│  [https://example.com/image.jpg      ] │
│                                          │
└─────────────────────────────────────────┘
```

---

## 🚀 Как протестировать

### Тест 1: Создание категории

```batch
1. Запустите: СТАРТ-ВСЁ.bat

2. Откройте: http://localhost:3001

3. Войдите: admin@aled.local / admin123

4. Перейдите: Категории (в меню слева)

5. Нажмите: "Добавить категорию"

6. Заполните:
   - Название: Светодиодные модули
   - Slug: (создастся автоматически)
   - Описание: Модули для автомобилей

7. Сохраните

8. Результат: Категория появилась в списке! ✅
```

### Тест 2: Загрузка изображения

```batch
1. Перейдите: Товары → Добавить товар

2. Найдите секцию "Изображения товара"

3. Вариант A - Drag & Drop:
   - Откройте проводник Windows
   - Найдите изображение на рабочем столе
   - Перетащите его в зону загрузки
   - ✅ Превью появилось!

4. Вариант B - Выбор файла:
   - Нажмите "Выбрать файлы"
   - Выберите изображение
   - ✅ Превью появилось!

5. Заполните остальные поля товара

6. Сохраните

7. Перейдите на витрину: http://localhost:3000

8. Результат: Товар с вашим изображением! ✅
```

### Тест 3: Использование категории в товаре

```batch
1. Создайте категорию (Тест 1)

2. Перейдите: Товары → Добавить товар

3. Найдите поле "Категория"

4. Результат: Ваша новая категория в списке! ✅

5. Выберите её и создайте товар

6. На витрине товар появится в этой категории! ✅
```

---

## 🔧 Технические детали

### Файлы, которые изменились:

1. **apps/admin/src/app/dashboard/categories/page.tsx** (НОВЫЙ)
   - Полная страница управления категориями
   - CRUD операции
   - Модальное окно для создания/редактирования

2. **apps/admin/src/app/dashboard/products/new/page.tsx**
   - Добавлена загрузка изображений (drag & drop, file upload)
   - Динамическая загрузка категорий из API
   - Конвертация изображений в Base64
   - Множественная загрузка файлов

3. **apps/admin/src/app/dashboard/layout.tsx**
   - Уже была ссылка на категории (не изменялось)

### Как работает загрузка изображений:

```typescript
// 1. Пользователь выбирает файл
<input type="file" onChange={handleImageUpload} />

// 2. Файл конвертируется в Base64
const reader = new FileReader()
reader.readAsDataURL(file)

// 3. Base64 сохраняется в состоянии
setUploadedImages(prev => [...prev, base64])

// 4. При сохранении товара отправляется в API
body: JSON.stringify({
  images: uploadedImages, // Array of Base64 strings
})
```

### Как работают категории:

```typescript
// 1. При загрузке страницы - запрос к API
useEffect(() => {
  fetchCategories()
}, [])

// 2. Загрузка категорий
const response = await api.get('/categories')
setCategories(response.data)

// 3. Отображение в select
<select>
  {categories.map(cat => (
    <option value={cat.id}>{cat.name}</option>
  ))}
</select>
```

---

## 📊 Преимущества

### До обновления:

❌ Категории захардкожены в коде  
❌ Нельзя создать новую категорию  
❌ Нужно вводить URL изображения вручную  
❌ Сложно добавлять фото с компьютера  

### После обновления:

✅ Категории создаются через админку  
✅ Drag & Drop для изображений  
✅ Выбор файлов из проводника  
✅ Превью изображений  
✅ Множественная загрузка  
✅ Динамический список категорий  

---

## ⚠️ Важные заметки

### Про изображения:

1. **Base64 в базе данных**
   - Изображения сохраняются как Base64 строки
   - Удобно для демо, но для продакшна лучше использовать файловое хранилище (S3, MinIO)
   - Размер Base64 примерно на 33% больше оригинала

2. **Ограничения размера**
   - Рекомендуется до 5MB на файл
   - Можно добавить проверку размера
   - Для больших изображений лучше использовать URL

3. **Формат данных**
   - API ожидает массив строк: `["data:image/png;base64,...", "https://..."]`
   - Можно миксовать Base64 и URL в одном товаре

### Про категории:

1. **Автоматический slug**
   - Генерируется из названия
   - Можно отредактировать вручную
   - Используется в URL на фронтенде

2. **Удаление категории**
   - Сейчас можно удалить даже если есть товары
   - Для продакшна добавить проверку:
     "Нельзя удалить категорию с товарами"

3. **API endpoints**
   - GET `/categories` - список
   - POST `/categories` - создать
   - PATCH `/categories/:id` - обновить
   - DELETE `/categories/:id` - удалить

---

## 🎉 Готово к использованию!

Запустите проект и попробуйте новые функции:

```batch
СТАРТ-ВСЁ.bat
```

**Откройте админку:**
- http://localhost:3001/dashboard/categories

**Протестируйте:**
1. Создайте категорию
2. Добавьте товар с фото
3. Проверьте на витрине

**Всё работает! 🚀**

---

**Дата:** Октябрь 2025  
**Версия:** 2.1.0  
**Новые функции:**
- ✅ Управление категориями
- ✅ Загрузка изображений
- ✅ Drag & Drop

