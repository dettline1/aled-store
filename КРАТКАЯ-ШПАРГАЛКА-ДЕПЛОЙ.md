# âš¡ Ð¨Ð¿Ð°Ñ€Ð³Ð°Ð»ÐºÐ°: Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð° 1 Ñ‡Ð°Ñ

## ðŸŽ¯ Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´

### 1ï¸âƒ£ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ
```bash
ssh root@Ð’ÐÐ¨_IP
```

---

### 2ï¸âƒ£ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÐŸÐž (ÑÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð²ÑÐµ ÑÑ€Ð°Ð·Ñƒ)
```bash
# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
apt update && apt upgrade -y

# Node.js 20.x
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# PM2
npm install -g pm2

# Nginx
apt install -y nginx
systemctl start nginx
systemctl enable nginx

# Git
apt install -y git

# Unzip (Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‡ÐµÑ€ÐµÐ· SCP)
apt install -y unzip
```

---

### 3ï¸âƒ£ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

**Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ A: Ð§ÐµÑ€ÐµÐ· SCP (Ñ Ð²Ð°ÑˆÐµÐ³Ð¾ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ð°)**

```powershell
# ÐÐ° Ð²Ð°ÑˆÐµÐ¼ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ðµ (PowerShell)
cd "C:\Aled fronted"
Compress-Archive -Path * -DestinationPath aled-project.zip -Force -CompressionLevel Fastest
scp aled-project.zip root@Ð’ÐÐ¨_IP:/var/www/
```

**ÐÐ° ÑÐµÑ€Ð²ÐµÑ€Ðµ:**
```bash
cd /var/www
unzip aled-project.zip -d aled-project
cd aled-project
```

**Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ B: Ð§ÐµÑ€ÐµÐ· Git**
```bash
cd /var/www
git clone https://github.com/Ð’ÐÐ¨_REPO.git aled-project
cd aled-project
```

---

### 4ï¸âƒ£ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
```bash
cd /var/www/aled-project
npm install
```

**Ð•ÑÐ»Ð¸ Ð½Ðµ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ Ð¿Ð°Ð¼ÑÑ‚Ð¸:**
```bash
# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ swap
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile

# ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ
swapoff /swapfile
rm /swapfile
```

---

### 5ï¸âƒ£ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð¾Ð²

```bash
# API .env
cat > demo-api/.env << 'EOF'
NODE_ENV=production
PORT=4000
EOF

# Frontend .env.local
cat > apps/frontend/.env.local << 'EOF'
NEXT_PUBLIC_API_URL=http://new.aaled.ru/api
NODE_ENV=production
EOF

# Admin .env.local
cat > apps/admin/.env.local << 'EOF'
NEXT_PUBLIC_API_URL=http://new.aaled.ru/api
NODE_ENV=production
EOF
```

---

### 6ï¸âƒ£ Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²

```bash
# Frontend
cd /var/www/aled-project/apps/frontend
npm run build

# Admin
cd /var/www/aled-project/apps/admin
npm run build

# Ð•ÑÐ»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ð°Ð¼ÑÑ‚Ð¸ - Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ swap (ÑÐ¼. Ð²Ñ‹ÑˆÐµ)
```

---

### 7ï¸âƒ£ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ PM2 ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

```bash
cd /var/www/aled-project
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [
    {
      name: 'aled-api',
      script: 'demo-api/simple-server.js',
      cwd: '/var/www/aled-project',
      env: { NODE_ENV: 'production', PORT: 4000 }
    },
    {
      name: 'aled-frontend',
      script: 'node_modules/.bin/next',
      args: 'start -p 3000',
      cwd: '/var/www/aled-project/apps/frontend',
      env: { NODE_ENV: 'production', PORT: 3000 }
    },
    {
      name: 'aled-admin',
      script: 'node_modules/.bin/next',
      args: 'start -p 3001',
      cwd: '/var/www/aled-project/apps/admin',
      env: { NODE_ENV: 'production', PORT: 3001 }
    }
  ]
};
EOF

# Ð—Ð°Ð¿ÑƒÑÐº
pm2 start ecosystem.config.js
pm2 save
pm2 startup
# Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ PM2
```

---

### 8ï¸âƒ£ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Nginx

```bash
# Frontend ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
cat > /etc/nginx/sites-available/aled-frontend << 'EOF'
server {
    listen 80;
    server_name new.aaled.ru;

    location /api {
        proxy_pass http://localhost:4000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        client_max_body_size 50M;
    }

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF

# Admin ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
cat > /etc/nginx/sites-available/aled-admin << 'EOF'
server {
    listen 80;
    server_name admin.new.aaled.ru;

    location /api {
        proxy_pass http://localhost:4000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        client_max_body_size 50M;
    }

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF

# ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ
rm /etc/nginx/sites-enabled/default
ln -s /etc/nginx/sites-available/aled-frontend /etc/nginx/sites-enabled/
ln -s /etc/nginx/sites-available/aled-admin /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
```

---

### 9ï¸âƒ£ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°

```bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹
pm2 status

# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ:
# aled-api         online
# aled-frontend    online
# aled-admin       online

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ (Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ IP):
# http://Ð’ÐÐ¨_IP:3000 - Ð²Ð¸Ñ‚Ñ€Ð¸Ð½Ð°
# http://Ð’ÐÐ¨_IP:3001 - Ð°Ð´Ð¼Ð¸Ð½ÐºÐ°
# http://Ð’ÐÐ¨_IP:4000/api/v1 - API
```

---

### ðŸ”Ÿ Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°

```bash
# ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ IP ÑÐµÑ€Ð²ÐµÑ€Ð°
hostname -I | awk '{print $1}'

# Ð¡ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÑƒ:
```

**Ð¢ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°:**
```
IP-Ð°Ð´Ñ€ÐµÑ ÑÐµÑ€Ð²ÐµÑ€Ð°: [Ð’ÐÐ¨_IP]

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ DNS Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð² Reg.ru:

1. Ð¢Ð¸Ð¿: A, ÐŸÐ¾Ð´Ð´Ð¾Ð¼ÐµÐ½: new, IP: [Ð’ÐÐ¨_IP], TTL: 3600
2. Ð¢Ð¸Ð¿: A, ÐŸÐ¾Ð´Ð´Ð¾Ð¼ÐµÐ½: admin.new, IP: [Ð’ÐÐ¨_IP], TTL: 3600

ÐŸÐ¾ÑÐ»Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ DNS (1-2 Ñ‡Ð°ÑÐ°) ÑÐ°Ð¹Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½:
â€¢ https://new.aaled.ru
â€¢ https://admin.new.aaled.ru

Ð”Ð°Ð¹Ñ‚Ðµ Ð·Ð½Ð°Ñ‚ÑŒ, ÐºÐ¾Ð³Ð´Ð° Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚Ðµ DNS - Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÑŽ SSL.
```

---

### 1ï¸âƒ£1ï¸âƒ£ SSL (Ð¿Ð¾ÑÐ»Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ DNS Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ¾Ð¼)

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Certbot
apt install -y certbot python3-certbot-nginx

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° DNS (Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ñ€ÐµÐ·Ð¾Ð»Ð²Ð¸Ñ‚ÑŒÑÑ Ð½Ð° Ð²Ð°Ñˆ IP)
ping new.aaled.ru
ping admin.new.aaled.ru

# ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð²
certbot --nginx -d new.aaled.ru -d admin.new.aaled.ru

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
certbot renew --dry-run
```

---

## âš¡ ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

```bash
# PM2
pm2 status              # Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
pm2 logs                # Ð›Ð¾Ð³Ð¸
pm2 restart all         # ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº
pm2 monit               # ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

# Nginx
systemctl status nginx  # Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
systemctl restart nginx # ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº
nginx -t                # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
cd /var/www/aled-project
git pull  # Ð¸Ð»Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð°Ñ€Ñ…Ð¸Ð²
npm install
cd apps/frontend && npm run build
cd ../admin && npm run build
pm2 restart all
```

---

## ðŸ†˜ Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### 502 Bad Gateway
```bash
pm2 restart all
systemctl restart nginx
```

### ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ
```bash
pm2 logs aled-frontend  # Ð¡Ð¼Ð¾Ñ‚Ñ€Ð¸Ð¼ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
pm2 delete aled-frontend
cd /var/www/aled-project/apps/frontend
npm run build
pm2 start ecosystem.config.js
```

### ÐÐµ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ Ð¿Ð°Ð¼ÑÑ‚Ð¸
```bash
# Swap 2GB
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
```

---

## âœ… Ð§ÐµÐºÐ»Ð¸ÑÑ‚

- [ ] VPS Ð°Ñ€ÐµÐ½Ð´Ð¾Ð²Ð°Ð½ (Timeweb/Beget)
- [ ] SSH Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
- [ ] ÐŸÐž ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ (Node.js, PM2, Nginx, Git)
- [ ] ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½ Ð² /var/www/aled-project
- [ ] Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ (npm install)
- [ ] .env Ñ„Ð°Ð¹Ð»Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹
- [ ] ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹ ÑÐ¾Ð±Ñ€Ð°Ð½Ñ‹ (npm run build)
- [ ] PM2 Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ (pm2 status = online)
- [ ] Nginx Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½
- [ ] Ð¡Ð°Ð¹Ñ‚Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð¿Ð¾ IP
- [ ] IP Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÑƒ
- [ ] Ð—Ð°ÐºÐ°Ð·Ñ‡Ð¸Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ð» DNS
- [ ] SSL ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ (certbot)
- [ ] Ð¡Ð°Ð¹Ñ‚Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð¿Ð¾ Ð´Ð¾Ð¼ÐµÐ½Ñƒ Ñ HTTPS

---

**Ð’Ñ€ÐµÐ¼Ñ: ~1 Ñ‡Ð°Ñ + 1-2 Ñ‡Ð°ÑÐ° Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ðµ DNS** â±ï¸

**Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!** ðŸš€

